import{r as m,j as i,q as l,b as e,Y as B,s as b,l as n,p as g,J as c,X as A,B as D,$ as E}from"./vendor.e47b60bf.js";import{a as p}from"./staffApi.72076233.js";import"./index.1de374d4.js";const x=[{value:"MAIN",label:"Main Campus"},{value:"KAMPALA",label:"Kampala Campus"}],M={rooms:[],invigilators:[],sessions:[]},y={invigilators:[],campus:[],date:new Date,session:[],room:""};function T(){const[u,S]=m.exports.useState(M),[s,r]=m.exports.useState(y),[h,v]=m.exports.useState([]),[_,d]=m.exports.useState(!1),q=async()=>{const a=await p.getAssignInvReqs();if(!a.ok)return console.log(a.data),alert("Failed to load the requirements needed to start assigning invigilators");console.log(a.data);let o={invigilators:[],rooms:[],sessions:[]};a.data.result.rooms.forEach(t=>{o.rooms.push({value:t.room_id,label:t.room_name})}),a.data.result.sessions.forEach(t=>{o.sessions.push({value:t.s_id,label:t.session_name})}),a.data.result.staff_members.forEach(t=>{o.invigilators.push({value:t.staff_id,label:`${t.title} ${t.staff_name}`})}),S(o)},C=async a=>{d(!0);const o=await p.getExamsInRoom(a);if(d(!1),!o.ok)return console.log("Error in getting exam data",o,a),alert("Failed to get the exams for the specified session and room");let t=[];o.data.result.forEach(f=>{t.push({value:f.course_unit_code,label:f.course_unit_name})}),v(t)},N=async a=>{a.preventDefault();const o={room:s.room,invigilators:s.invigilators,session:s.session,date:s.date,campus:s.campus,status:0,assigned_by:1};d(!0);const t=await p.addInvigilators(o);if(d(!1),!t.ok)return console.log("Failed to add invigilator data to the database",t.data),alert("Failed to add invigilator data to the database");if(t.data.success)return r(y),v([]),E.fire({icon:"success",title:"Success",text:t.data.message})};return m.exports.useEffect(()=>{q()},[]),i(l,{md:12,xl:12,xs:12,sm:12,children:[_?e("div",{className:"overlay_dashboard",style:{},children:e(B,{animation:"border",variant:"primary",className:"",role:"status",children:e("span",{className:"sr-only",children:"Loading..."})})}):null,e(b,{className:"card-primary",children:e(b.Body,{children:i(n,{onSubmit:N,children:[e("div",{className:"main-content-label mg-b-5",children:"Assign Invigilators"}),e("p",{className:"mg-b-20",children:"exams/Assign invigilators"}),i(l,{lg:12,children:[i(g,{children:[e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Campus"}),e(c,{classNamePrefix:"Select-sm",name:"staff",required:!0,defaultValue:x[0],value:s.campus[0],onChange:a=>{s.campus=a,r({...s})},options:x,placeholder:"Campus"})]})}),e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Date"}),e(A,{selected:s.date,onChange:a=>{const o=new Date(a).getFullYear()+"-"+(new Date(a).getMonth()+1)+"-"+new Date(a).getDate();console.log("Date",o),s.date=a,r({...s})},dateFormat:"yyyy-MM-dd",className:"form-control date-picker"})," "]})})]}),i(g,{children:[e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Room"}),e(c,{classNamePrefix:"Select-sm",name:"room",required:!0,value:s.room,onChange:a=>{s.room=a,r({...s})},options:u.rooms,placeholder:"Select Room"})]})}),e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Session"}),e(c,{classNamePrefix:"Select-sm",name:"session",required:!0,value:s.session,onChange:a=>{s.session=a,r({...s});const o={date:s.date,room:s.room,session:a,campus:s.campus};s.room&&C(o)},options:u.sessions,placeholder:"Select Session"})]})})]}),i(g,{children:[e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Exam"}),e(c,{options:h,isMulti:!0,maxMenuHeight:200,value:h})]})}),e(l,{lg:6,md:6,children:i(n.Group,{style:{marginBottom:10,marginTop:0},children:[e("label",{children:"Invigilator"}),e(c,{classNamePrefix:"Select-sm",isMulti:!0,name:"invigilator",required:!0,value:s.invigilators,onChange:a=>{s.invigilators=a,r({...s})},options:u.invigilators,placeholder:"Select Invigilator"})]})})]}),e(D,{type:"submit",children:"Assign"})]})]})})})]})}export{T as default};
