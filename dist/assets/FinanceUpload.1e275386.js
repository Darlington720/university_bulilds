import{Q as z,r as s,j as r,b as e,l as _,p as H,q as u,J as A,s as J,af as K,B as O,Y as F,a7 as Q,a1 as B,H as V,ag as G,ah as W,$ as D}from"./vendor.daf4729c.js";import{a as L}from"./staffApi.2bb1a99d.js";import{u as X,b as Z}from"./index.e385e002.js";const ee=X.baseUrl1,ae=z(ee),se=[{value:"1",label:"1"},{value:"2",label:"2"}];function oe(){const p=s.exports.useRef(null),[f,h]=s.exports.useState([]),[k,te]=s.exports.useState(!1),[g,y]=s.exports.useState(!1),[S,re]=s.exports.useState(0),[C,x]=s.exports.useState(),[P,U]=s.exports.useState(),[i,E]=s.exports.useState(""),[d,Y]=s.exports.useState(""),[j,T]=s.exports.useState(),b=async()=>{x(!0);const a=await L.lastUploadDate();if(x(!1),!a.ok)return console.log("Error in fetching the last upload date and time",a.data.data);U(a.data.data.upload_date)},R=async()=>{const a=await Z.getAccYrs();if(!a.ok)return alert("Failed to fetch acc_yrs");T(a.data.map(t=>({value:t.id,label:t.acc_yr})))};s.exports.useEffect(()=>{b(),R()},[]);const $=a=>new Promise((t,n)=>{const l=new FileReader;l.onload=o=>{const m=o.target.result;t(m)},l.onerror=o=>{n(o)},l.readAsArrayBuffer(a)}),q=async()=>{for(const a of f)try{const t=await $(a),n=G(t),l=n.Sheets[n.SheetNames[0]],m=W.sheet_to_json(l).map(w=>{const v={};for(const N in w){let I=N.replace(/"/g,"");v[I]=w[N].replace(/"/g,"")}return v}),M={acc_yr_id:d.value,sem:i.value,students:m};y(!0);const c=await L.importExcelToDB(M);return y(!1),c.data.success?(p.current.removeFiles(),h([]),b(),ae.emit("update_elligible_voters_from_upload",{elligible_voters:c.data.result.elligibleVoters+c.data.result.exemptedStudents}),D.fire({icon:"success",title:"Success",text:c.data.message})):D.fire({title:"Error!!!",text:c.data.message})}catch(t){console.error("Error reading file:",t)}};return r("div",{children:[e(_,{children:r(H,{className:"row-sm center",style:{marginBottom:20},children:[r(u,{lg:2,children:[e("label",{className:"lb",children:"Acc Yr"}),e(A,{classNamePrefix:"Select-sm",required:!0,value:d,onChange:a=>Y(a),options:j,placeholder:"Select acc yr"})]}),r(u,{lg:2,children:[e("label",{className:"lb",children:"Sem"}),e(A,{classNamePrefix:"Select-sm",required:!0,value:i,onChange:a=>E(a),options:se,placeholder:"Select sem"})]})]})}),r(J,{style:{padding:10},children:[e(_.Label,{className:"mt-3",children:"Upload Excel files here"}),e(K,{ref:p,className:"mt-3 mb-3",allowMultiple:!0,maxFiles:1,acceptedFileTypes:["csv"],name:"excelFile",onupdatefiles:a=>{h(a.map(t=>t.file))}}),e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:e(u,{sm:6,md:2,className:"mg-t-10 mg-sm-t-0 justify-center",children:e(O,{variant:"primary",className:"btn-block",disabled:f.length===0||!d||!i||g,onClick:q,children:g?e(F,{animation:"border",size:"sm",className:"",role:"status","aria-hidden":"true",children:e("span",{className:"sr-only",children:"Loading..."})}):"Upload"})})})]}),e("div",{style:{display:"flex",justifyContent:"center"},children:r(Q,{variant:"primary",style:{padding:5,alignSelf:"center"},children:["Last Update Date:",C?e(F,{animation:"grow",className:"",role:"status",children:e("span",{className:"sr-only",children:"Loading..."})}):new Date(P).toLocaleString()]})}),e(B,{show:k,backdrop:"static",centered:!0,children:r(B.Body,{className:"text-center p-2 pb-0",children:[e("h4",{style:{textAlign:"center"},children:"Progress (%)"}),e(V,{className:"h-8",variant:"primary",now:S*100,label:`${(S*100).toFixed(2)}%`}),e("div",{style:{margin:10},children:e("h6",{children:"Please wait..."})})]})})]})}export{oe as default};
