import{r as s,j as i,s as C,b as e,l as P,af as _,q as k,B as E,Y as S,a7 as T,a1 as b,H as R,ag as $,ah as I,$ as F}from"./vendor.daf4729c.js";import{a as M}from"./staffApi.acf86b8e.js";import{c as V}from"./index.fbf37228.js";function Y(){const d=s.exports.useRef(null),[f,p]=s.exports.useState([]),[N,q]=s.exports.useState(!1),[m,z]=s.exports.useState(0),[L,u]=s.exports.useState(),[B,h]=s.exports.useState(!1);s.exports.useState([]);const[D,v]=s.exports.useState(),g=async()=>{u(!0);const a=await M.lastUploadDate();if(u(!1),!a.ok)return console.log("Error in fetching the last upload date and time",a.data.data);v(a.data.data.upload_date)};s.exports.useEffect(()=>{g()},[]);const A=a=>new Promise((t,l)=>{const r=new FileReader;r.onload=n=>{const o=n.target.result;t(o)},r.onerror=n=>{l(n)},r.readAsArrayBuffer(a)}),j=async()=>{for(const a of f)try{const t=await A(a);console.log("ArrayBuffer:",t);const l=$(t),r=l.Sheets[l.SheetNames[0]],o=I.sheet_to_json(r).map(y=>{const x={};for(const w in y){let U=w.replace(/"/g,"");x[U]=y[w].replace(/"/g,"")}return x});console.log("The final object",o),h(!0);const c=await V.uploadVoters(o);return h(!1),c.data.success?(d.current.removeFiles(),p([]),g(),F.fire({icon:"success",title:"Success",text:c.data.message})):F.fire({title:"Error!!!",text:c.data.message})}catch(t){console.error("Error reading file:",t)}};return i("div",{children:[i(C,{style:{padding:10},children:[e(P.Label,{className:"mt-3",children:"Upload Voters Files"}),e(_,{ref:d,className:"mt-3 mb-3",allowMultiple:!0,maxFiles:50,name:"excelFile",onupdatefiles:a=>{p(a.map(t=>t.file))}}),e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:e(k,{sm:6,md:2,className:"mg-t-10 mg-sm-t-0 justify-center",children:e(E,{variant:"primary",className:"btn-block",disabled:f.length===0,onClick:j,children:B?e(S,{animation:"border",size:"sm",className:"",role:"status","aria-hidden":"true",children:e("span",{className:"sr-only",children:"Loading..."})}):"Upload"})})})]}),e("div",{style:{display:"flex",justifyContent:"center"},children:i(T,{variant:"primary",style:{padding:5,alignSelf:"center"},children:["Last Update Date:",L?e(S,{animation:"grow",className:"",role:"status",children:e("span",{className:"sr-only",children:"Loading..."})}):new Date(D).toLocaleString()]})}),e(b,{show:N,backdrop:"static",centered:!0,children:i(b.Body,{className:"text-center p-2 pb-0",children:[e("h4",{style:{textAlign:"center"},children:"Progress (%)"}),e(R,{className:"h-8",variant:"primary",now:m*100,label:`${(m*100).toFixed(2)}%`}),e("div",{style:{margin:10},children:e("h6",{children:"Please wait..."})})]})})]})}export{Y as default};
