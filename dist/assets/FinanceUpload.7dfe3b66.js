import{Q as E,r as t,j as i,s as j,b as e,l as P,af as C,q as T,B as R,Y as S,a7 as I,a1 as b,H as M,ag as $,ah as q,$ as N}from"./vendor.81523695.js";import{a as _}from"./staffApi.1e39a766.js";import{u as z}from"./index.1a6db8a1.js";const H=z.baseUrl1,K=E(H);function J(){const d=t.exports.useRef(null),[u,m]=t.exports.useState([]),[v,O]=t.exports.useState(!1),[D,p]=t.exports.useState(!1),[f,Q]=t.exports.useState(0),[F,g]=t.exports.useState(),[L,B]=t.exports.useState(),h=async()=>{g(!0);const a=await _.lastUploadDate();if(g(!1),!a.ok)return console.log("Error in fetching the last upload date and time",a.data.data);B(a.data.data.upload_date)};t.exports.useEffect(()=>{h()},[]);const k=a=>new Promise((s,o)=>{const r=new FileReader;r.onload=n=>{const c=n.target.result;s(c)},r.onerror=n=>{o(n)},r.readAsArrayBuffer(a)}),U=async()=>{for(const a of u)try{const s=await k(a),o=$(s),r=o.Sheets[o.SheetNames[0]],c=q.sheet_to_json(r).map(y=>{const x={};for(const w in y){let A=w.replace(/"/g,"");x[A]=y[w].replace(/"/g,"")}return x});p(!0);const l=await _.importExcelToDB(c);return p(!1),l.data.success?(d.current.removeFiles(),m([]),h(),K.emit("update_elligible_voters_from_upload",{elligible_voters:l.data.result.elligibleVoters+l.data.result.exemptedStudents}),N.fire({icon:"success",title:"Success",text:l.data.message})):N.fire({title:"Error!!!",text:l.data.message})}catch(s){console.error("Error reading file:",s)}};return i("div",{children:[i(j,{style:{padding:10},children:[e(P.Label,{className:"mt-3",children:"Upload Excel files here"}),e(C,{ref:d,className:"mt-3 mb-3",allowMultiple:!0,maxFiles:50,name:"excelFile",onupdatefiles:a=>{m(a.map(s=>s.file))}}),e("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:e(T,{sm:6,md:2,className:"mg-t-10 mg-sm-t-0 justify-center",children:e(R,{variant:"primary",className:"btn-block",disabled:u.length===0,onClick:U,children:D?e(S,{animation:"border",size:"sm",className:"",role:"status","aria-hidden":"true",children:e("span",{className:"sr-only",children:"Loading..."})}):"Upload"})})})]}),e("div",{style:{display:"flex",justifyContent:"center"},children:i(I,{variant:"primary",style:{padding:5,alignSelf:"center"},children:["Last Update Date:",F?e(S,{animation:"grow",className:"",role:"status",children:e("span",{className:"sr-only",children:"Loading..."})}):new Date(L).toLocaleString()]})}),e(b,{show:v,backdrop:"static",centered:!0,children:i(b.Body,{className:"text-center p-2 pb-0",children:[e("h4",{style:{textAlign:"center"},children:"Progress (%)"}),e(M,{className:"h-8",variant:"primary",now:f*100,label:`${(f*100).toFixed(2)}%`}),e("div",{style:{margin:10},children:e("h6",{children:"Please wait..."})})]})})]})}export{J as default};
